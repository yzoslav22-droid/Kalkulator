<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Российский Калькулятор</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            overflow: hidden;
            position: relative;
            background: linear-gradient(135deg, #0033a0 0%, #ffffff 45%, #ffffff 55%, #d52b1e 100%);
            min-height: 100vh;
        }
        #calculator {
            width: 320px;
            margin: 0 auto;
            background-color: #333;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0,0,0,0.7);
            position: relative;
            z-index: 10;
            overflow: hidden;
        }
        #display {
            width: 100%;
            height: 60px;
            background-color: #eee;
            border: none;
            text-align: right;
            font-size: 24px;
            padding: 10px;
            box-sizing: border-box;
            margin-bottom: 15px;
            border-radius: 8px;
            font-weight: bold;
        }
        .buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        button {
            height: 45px;
            border: none;
            border-radius: 8px;
            background-color: #555;
            color: white;
            font-size: 16px;
            cursor: pointer;
            padding: 0 5px;
            box-sizing: border-box;
            text-overflow: ellipsis;
            white-space: normal;
            word-wrap: break-word;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.2;
        }
        button:hover {
            background-color: #777;
        }
        button.decision-btn {
            font-size: 11px;
            height: 55px;
            padding: 5px;
            white-space: normal;
            line-height: 1.1;
        }
        #voteModal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(0,0,0,0.7);
            z-index: 100;
            text-align: center;
            max-width: 90%;
            width: 300px;
        }
        #noButton {
            position: absolute;
            padding: 8px 16px;
            background-color: #d52b1e;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }
        #yesButton {
            margin: 15px 0 10px;
            padding: 10px 20px;
            background-color: #0033a0;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        #stats {
            position: fixed;
            top: 10px;
            right: 10px;
            background-color: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            z-index: 20;
            min-width: 200px;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        #fsbMessage {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            color: #d52b1e;
            font-size: 36px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
            text-align: center;
        }
        #fsbImage {
            width: 200px;
            margin-bottom: 20px;
        }
        #battleScreen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.95);
            color: white;
            z-index: 300;
            padding: 20px;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }
        #battleChat {
            width: 100%;
            height: 70%;
            background-color: #111;
            border: 1px solid #444;
            border-radius: 10px;
            padding: 15px;
            box-sizing: border-box;
            overflow-y: auto;
            margin-bottom: 20px;
            font-size: 16px;
            line-height: 1.6;
        }
        .chat-message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 8px;
            max-width: 80%;
            word-wrap: break-word;
        }
        .player-message {
            background-color: #0033a0;
            color: white;
            margin-left: auto;
            text-align: right;
        }
        .enemy-message {
            background-color: #d52b1e;
            color: white;
            margin-right: auto;
        }
        .battle-button {
            padding: 12px 20px;
            margin: 5px;
            background-color: #0033a0;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }
        #attackButton {
            margin-right: 10px;
        }
        .progress-bar {
            width: 100%;
            background-color: #444;
            margin: 8px 0;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        #patriotismFill {
            background-color: #d52b1e;
        }
        #agentFill {
            background-color: #0033a0;
        }
        #extremismFill {
            background-color: #ff6600;
        }
        #loyaltyFill {
            background-color: #8a2be2; /* Фиолетовый */
        }
        #svoSupportFill {
            background-color: #d52b1e;
        }
        /* Mode switch buttons */
        .mode-switch {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            gap: 10px;
        }
        .mode-switch button {
            flex: 1;
            height: 40px;
            font-size: 14px;
            font-weight: bold;
        }
        /* End screen */
        #endScreen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            color: white;
            z-index: 400;
            padding: 20px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        #endScreen h1 {
            font-size: 36px;
            margin-bottom: 30px;
            text-shadow: 0 0 10px #d52b1e;
        }
        #endScreen p {
            font-size: 20px;
            line-height: 1.6;
            max-width: 800px;
            margin-bottom: 40px;
        }
        #endButton {
            padding: 15px 30px;
            background-color: #d52b1e;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="calculator">
        <input type="text" id="display" readonly>
        <div class="buttons" id="mainButtons">
            <button>7</button>
            <button>8</button>
            <button>9</button>
            <button>/</button>
            <button>4</button>
            <button>5</button>
            <button>6</button>
            <button>*</button>
            <button>1</button>
            <button>2</button>
            <button>3</button>
            <button>-</button>
            <button>0</button>
            <button>C</button>
            <button>=</button>
            <button>+</button>
        </div>
        <div class="buttons" id="economyButtons" style="display: none;">
            <button class="decision-btn">Платить налоги<br>(+5 патриотизма)</button>
            <button class="decision-btn">Кормить олигархов<br>($100)</button>
            <button class="decision-btn">Инвестировать в<br>гособлигации</button>
            <button class="decision-btn">Поддержать СВО<br>(500₽)</button>
            <button class="decision-btn">Купить золото ЦБ</button>
            <button class="decision-btn">Открыть вклад<br>в Сбербанке</button>
            <button class="decision-btn">Продать валюту ЦБ</button>
            <button class="decision-btn">Кредит на<br>развитие бизнеса</button>
            <button class="decision-btn">Субсидия на<br>сельское хозяйство</button>
            <button class="decision-btn">Назад</button>
        </div>
        <div class="buttons" id="armyButtons" style="display: none;">
            <button class="decision-btn">Закупить новую<br>технику (1000₽)</button>
            <button class="decision-btn">Повысить зарплату<br>военным</button>
            <button class="decision-btn">Провести учения</button>
            <button class="decision-btn">Модернизировать<br>ядерное оружие</button>
            <button class="decision-btn">Открыть военную<br>базу за рубежом</button>
            <button class="decision-btn">Провести<br>парад Победы</button>
            <button class="decision-btn">Разработать<br>гиперзвуковое оружие</button>
            <button class="decision-btn">Увеличить<br>призывников</button>
            <button class="decision-btn">Поддержать<br>ветеранов</button>
            <button class="decision-btn">Назад</button>
        </div>
        <div class="buttons" id="politicsButtons" style="display: none;">
            <button class="decision-btn">Заключить союз<br>с Китаем (+50 п.)</button>
            <button class="decision-btn">Подать заявку<br>в НАТО (-100 п.)</button>
            <button class="decision-btn">Провести выборы<br>(+10 патриотизма)</button>
            <button class="decision-btn">Ужесточить цензуру<br>(-20 п., +30 ино.)</button>
            <button class="decision-btn">Разогнать оппозицию<br>(-50 п., +100 ино.)</button>
            <button class="decision-btn">Поддержать<br>ЛНР/ДНР (+30 п.)</button>
            <button class="decision-btn">Провести<br>референдум (+20 п.)</button>
            <button class="decision-btn">Арестовать<br>иноагентов (+10 п.)</button>
            <button class="decision-btn">Запретить ЛГБТ<br>(+15 патриотизма)</button>
            <button class="decision-btn">Назад</button>
        </div>
        <div class="mode-switch">
            <button>Экономика</button>
            <button>Армия</button>
            <button>Политика</button>
        </div>
    </div>

    <div id="stats">
        <div>Патриотизм: <span id="patriotismValue">0</span></div>
        <div class="progress-bar">
            <div id="patriotismFill" class="progress-fill" style="width: 0%"></div>
        </div>
        <div>Иноагенты: <span id="agentValue">0</span></div>
        <div class="progress-bar">
            <div id="agentFill" class="progress-fill" style="width: 0%"></div>
        </div>
        <div>Экстремизм: <span id="extremismValue">0</span></div>
        <div class="progress-bar">
            <div id="extremismFill" class="progress-fill" style="width: 0%"></div>
        </div>
        <div>Лояльность олигархов: <span id="loyaltyValue">50</span></div>
        <div class="progress-bar">
            <div id="loyaltyFill" class="progress-fill" style="width: 50%"></div>
        </div>
        <div>Поддержка СВО: <span id="svoSupportValue">0</span></div>
        <div class="progress-bar">
            <div id="svoSupportFill" class="progress-fill" style="width: 0%"></div>
        </div>
        <div>Рубли: <span id="moneyValue">0</span>₽</div>
        <div>Доллары: <span id="dollarValue">0</span>$</div>
        <div>Вклад: <span id="depositValue">0</span>₽</div>
        <div>Кредит: <span id="creditValue">0</span>₽</div>
    </div>

    <div id="voteModal">
        <h2>Важный вопрос!</h2>
        <p id="voteQuestion">Проголосуйте за поправки в Конституцию</p>
        <button id="yesButton">За</button>
        <button id="noButton">Против</button>
    </div>

    <div id="fsbMessage">
        <img id="fsbImage" src="fsb.png" alt="ФСБ">
        <div id="fsbText">ФСБ выехали к вам!</div>
        <div id="fsbReason">Причина: участие в экстремистском сообществе</div>
        <div style="margin-top: 20px; font-size: 24px;">Ожидайте в ближайшие 15 минут...</div>
    </div>

    <div id="battleScreen">
        <div id="battleChat"></div>
        <div style="display: flex; justify-content: center;">
            <button id="attackButton" class="battle-button">Атаковать</button>
            <button id="healButton" class="battle-button">Лечиться</button>
        </div>
    </div>

    <div id="endScreen">
        <h1 id="endTitle">КОНЕЦ ИГРЫ</h1>
        <p id="endText">Текст концовки будет здесь...</p>
        <button id="endButton">Начать заново</button>
    </div>

    <audio id="anthem" loop>
        <source src="gimn.mp3" type="audio/mpeg">
    </audio>
    <audio id="battleMusic" loop>
        <source src="matushka.mp3" type="audio/mpeg">
    </audio>

    <script>
        // Основные переменные игры
        let patriotism = 0;
        let agents = 0;
        let extremism = 0;
        let loyalty = 50; // Лояльность олигархов
        let svoSupport = 0; // Поддержка СВО
        let money = 0;
        let dollars = 0;
        let deposit = 0;
        let credit = 0;

        let displayValue = '';
        let currentMode = 'main';
        let voteCount = 0;
        let autoVote = false;
        let battleInProgress = false;
        let currentEnemy = null;
        let playerMorality = 100; // Здоровье морали игрока
        let enemyReputation = 100; // Здоровье репутации врага

        const anthem = document.getElementById('anthem');
        const battleMusic = document.getElementById('battleMusic');

        // Элементы интерфейса
        const voteModal = document.getElementById('voteModal');
        const yesButton = document.getElementById('yesButton');
        const noButton = document.getElementById('noButton');
        const voteQuestion = document.getElementById('voteQuestion');
        const fsbMessage = document.getElementById('fsbMessage');
        const fsbText = document.getElementById('fsbText');
        const fsbReason = document.getElementById('fsbReason');
        const battleScreen = document.getElementById('battleScreen');
        const battleChat = document.getElementById('battleChat');
        const attackButton = document.getElementById('attackButton');
        const healButton = document.getElementById('healButton');
        const endScreen = document.getElementById('endScreen');
        const endTitle = document.getElementById('endTitle');
        const endText = document.getElementById('endText');
        const endButton = document.getElementById('endButton');

        // Элементы статистики
        const patriotismValue = document.getElementById('patriotismValue');
        const agentValue = document.getElementById('agentValue');
        const extremismValue = document.getElementById('extremismValue');
        const loyaltyValue = document.getElementById('loyaltyValue');
        const svoSupportValue = document.getElementById('svoSupportValue');
        const moneyValue = document.getElementById('moneyValue');
        const dollarValue = document.getElementById('dollarValue');
        const depositValue = document.getElementById('depositValue');
        const creditValue = document.getElementById('creditValue');

        const patriotismFill = document.getElementById('patriotismFill');
        const agentFill = document.getElementById('agentFill');
        const extremismFill = document.getElementById('extremismFill');
        const loyaltyFill = document.getElementById('loyaltyFill');
        const svoSupportFill = document.getElementById('svoSupportFill');

        // Элементы калькулятора
        const display = document.getElementById('display');
        const mainButtons = document.getElementById('mainButtons');
        const economyButtons = document.getElementById('economyButtons');
        const armyButtons = document.getElementById('armyButtons');
        const politicsButtons = document.getElementById('politicsButtons');

        // Получаем все кнопки
        const numberButtons = mainButtons.querySelectorAll('button');
        const economyBtns = economyButtons.querySelectorAll('button');
        const armyBtns = armyButtons.querySelectorAll('button');
        const politicsBtns = politicsButtons.querySelectorAll('button');
        const modeSwitchButtons = document.querySelector('.mode-switch').querySelectorAll('button');

        // Назначаем обработчики для кнопок калькулятора
        numberButtons[0].onclick = () => appendToDisplay('7');
        numberButtons[1].onclick = () => appendToDisplay('8');
        numberButtons[2].onclick = () => appendToDisplay('9');
        numberButtons[3].onclick = () => appendToDisplay('/');
        numberButtons[4].onclick = () => appendToDisplay('4');
        numberButtons[5].onclick = () => appendToDisplay('5');
        numberButtons[6].onclick = () => appendToDisplay('6');
        numberButtons[7].onclick = () => appendToDisplay('*');
        numberButtons[8].onclick = () => appendToDisplay('1');
        numberButtons[9].onclick = () => appendToDisplay('2');
        numberButtons[10].onclick = () => appendToDisplay('3');
        numberButtons[11].onclick = () => appendToDisplay('-');
        numberButtons[12].onclick = () => appendToDisplay('0');
        numberButtons[13].onclick = () => clearDisplay();
        numberButtons[14].onclick = () => calculate();
        numberButtons[15].onclick = () => appendToDisplay('+');

        // Обработчики для экономических решений
        economyBtns[0].onclick = () => makeDecision('Платить налоги (+5 патриотизма)');
        economyBtns[1].onclick = () => makeDecision('Кормить олигархов ($100)');
        economyBtns[2].onclick = () => makeDecision('Инвестировать в гособлигации');
        economyBtns[3].onclick = () => makeDecision('Поддержать СВО (500₽)');
        economyBtns[4].onclick = () => makeDecision('Купить золото ЦБ');
        economyBtns[5].onclick = () => makeDecision('Открыть вклад в Сбербанке');
        economyBtns[6].onclick = () => makeDecision('Продать валюту ЦБ');
        economyBtns[7].onclick = () => makeDecision('Кредит на развитие бизнеса');
        economyBtns[8].onclick = () => makeDecision('Субсидия на сельское хозяйство');
        economyBtns[9].onclick = () => switchToMain();

        // Обработчики для армейских решений
        armyBtns[0].onclick = () => makeDecision('Закупить новую технику (1000₽)');
        armyBtns[1].onclick = () => makeDecision('Повысить зарплату военным');
        armyBtns[2].onclick = () => makeDecision('Провести учения');
        armyBtns[3].onclick = () => makeDecision('Модернизировать ядерное оружие');
        armyBtns[4].onclick = () => makeDecision('Открыть военную базу за рубежом');
        armyBtns[5].onclick = () => makeDecision('Провести парад Победы');
        armyBtns[6].onclick = () => makeDecision('Разработать гиперзвуковое оружие');
        armyBtns[7].onclick = () => makeDecision('Увеличить призывников');
        armyBtns[8].onclick = () => makeDecision('Поддержать ветеранов');
        armyBtns[9].onclick = () => switchToMain();

        // Обработчики для политических решений
        politicsBtns[0].onclick = () => makeDecision('Заключить союз с Китаем (+50 патриотизма)');
        politicsBtns[1].onclick = () => makeDecision('Подать заявку в НАТО (-100 патриотизма, +50 иноагентов)');
        politicsBtns[2].onclick = () => makeDecision('Провести выборы (+10 патриотизма)');
        politicsBtns[3].onclick = () => makeDecision('Ужесточить цензуру (-20 патриотизма, +30 иноагентов)');
        politicsBtns[4].onclick = () => makeDecision('Разогнать оппозицию (-50 патриотизма, +100 иноагентов)');
        politicsBtns[5].onclick = () => makeDecision('Поддержать ЛНР/ДНР (+30 патриотизма)');
        politicsBtns[6].onclick = () => makeDecision('Провести референдум (+20 патриотизма)');
        politicsBtns[7].onclick = () => makeDecision('Арестовать иноагентов (+10 патриотизма)');
        politicsBtns[8].onclick = () => makeDecision('Запретить ЛГБТ (+15 патриотизма)');
        politicsBtns[9].onclick = () => switchToMain();

        // Обработчики для переключения режимов
        modeSwitchButtons[0].onclick = () => switchToEconomy();
        modeSwitchButtons[1].onclick = () => switchToArmy();
        modeSwitchButtons[2].onclick = () => switchToPolitics();

        // Кнопка "Против" убегает от курсора
        noButton.addEventListener('mouseover', function() {
            const modalRect = voteModal.getBoundingClientRect();
            const buttonRect = noButton.getBoundingClientRect();
            let newX, newY;
            do {
                newX = Math.random() * (modalRect.width - buttonRect.width - 20) + 10;
                newY = Math.random() * (modalRect.height - buttonRect.height - 60) + 50;
            } while (
                Math.abs(newX - buttonRect.left + modalRect.left) < 50 &&
                Math.abs(newY - buttonRect.top + modalRect.top) < 50
            );
            noButton.style.left = newX + 'px';
            noButton.style.top = newY + 'px';
        });

        // Обработчики голосования
        yesButton.addEventListener('click', function() {
            voteCount++;
            if (voteQuestion.textContent.includes("Конституцию")) {
                addPatriotism(50);
            } else if (voteQuestion.textContent.includes("Путина")) {
                addPatriotism(100);
            }
            voteModal.style.display = 'none';
            scheduleNextVote();
        });

        noButton.addEventListener('click', function() {
            voteModal.style.display = 'none';
            scheduleNextVote();
        });

        // Функция планирования следующего голосования
        function scheduleNextVote() {
            setTimeout(function() {
                if (Math.random() < 0.3 || voteCount % 3 === 0) {
                    showVoteModal();
                }
            }, 10000 + Math.random() * 20000);
        }

        // Функция показа модального окна голосования
        function showVoteModal() {
            if (autoVote) return;
            voteModal.style.display = 'block';
            noButton.style.left = 'calc(50% - 40px)';
            noButton.style.top = 'calc(50% + 30px)';
            if (Math.random() < 0.5) {
                voteQuestion.textContent = "Проголосуйте за поправки в Конституцию";
            } else {
                voteQuestion.textContent = "Проголосуйте за Путина";
            }
            // Автоматическое голосование через 10 секунд
            setTimeout(function() {
                if (voteModal.style.display === 'block') {
                    voteModal.style.display = 'none';
                    autoVote = true;
                    addMessageToChat("Система проголосовала автоматически (патриотизм не начислен)", 'system');
                    scheduleNextVote();
                }
            }, 10000);
        }

        // Функция обновления статистики
        function updateStats() {
            patriotismValue.textContent = patriotism;
            agentValue.textContent = agents;
            extremismValue.textContent = extremism;
            loyaltyValue.textContent = loyalty;
            svoSupportValue.textContent = svoSupport;
            moneyValue.textContent = money;
            dollarValue.textContent = dollars;
            depositValue.textContent = deposit;
            creditValue.textContent = credit;

            // Обновление прогресс-баров
            let patriotismPercentage = Math.max(0, Math.min(100, (patriotism + 1000000) / 2000000 * 100));
            patriotismFill.style.width = patriotismPercentage + '%';

            let agentPercentage = Math.min(100, agents / 10000 * 100);
            agentFill.style.width = agentPercentage + '%';

            let extremismPercentage = Math.min(100, extremism / 1000 * 100);
            extremismFill.style.width = extremismPercentage + '%';

            let loyaltyPercentage = Math.max(0, Math.min(100, loyalty));
            loyaltyFill.style.width = loyaltyPercentage + '%';

            let svoSupportPercentage = Math.min(100, svoSupport / 1000 * 100);
            svoSupportFill.style.width = svoSupportPercentage + '%';

            // Проверка триггеров для битв
            checkBattleTriggers();
        }

        // Проверка триггеров для начала битв
        function checkBattleTriggers() {
            if (!battleInProgress) {
                // Боссы за НИЗКИЙ патриотизм
                if (patriotism <= -10000) {
                    startBattle('solovev');
                } else if (patriotism <= -100000) {
                    startBattle('medvedev');
                } else if (patriotism <= -1000000) {
                    startBattle('putin');
                }
                // Боссы за ВЫСОКИЙ патриотизм
                else if (patriotism >= 10000) {
                    startBattle('gays');
                } else if (patriotism >= 100000) {
                    startBattle('uncle_sam');
                } else if (patriotism >= 1000000) {
                    startBattle('satan');
                }
            }
        }

        // Функция переключения на экономический режим
        function switchToEconomy() {
            mainButtons.style.display = 'none';
            economyButtons.style.display = 'grid';
            armyButtons.style.display = 'none';
            politicsButtons.style.display = 'none';
            currentMode = 'economy';
        }

        // Функция переключения на армейский режим
        function switchToArmy() {
            mainButtons.style.display = 'none';
            economyButtons.style.display = 'none';
            armyButtons.style.display = 'grid';
            politicsButtons.style.display = 'none';
            currentMode = 'army';
        }

        // Функция переключения на политический режим
        function switchToPolitics() {
            mainButtons.style.display = 'none';
            economyButtons.style.display = 'none';
            armyButtons.style.display = 'none';
            politicsButtons.style.display = 'grid';
            currentMode = 'politics';
        }

        // Функция возврата в основной режим
        function switchToMain() {
            mainButtons.style.display = 'grid';
            economyButtons.style.display = 'none';
            armyButtons.style.display = 'none';
            politicsButtons.style.display = 'none';
            currentMode = 'main';
        }

        // Функция принятия решения
        function makeDecision(decision) {
            addMessageToChat("Принято решение: " + decision, 'system');
            
            // Обработка решений
            if (decision.includes("Платить налоги")) {
                addPatriotism(5);
            } else if (decision.includes("Кормить олигархов")) {
                if (money >= 100) {
                    money -= 100;
                    loyalty += 10;
                    if (loyalty > 100) loyalty = 100;
                    addPatriotism(10);
                } else {
                    addMessageToChat("Недостаточно денег!", 'system');
                }
            } else if (decision.includes("Поддержать СВО")) {
                if (money >= 500) {
                    money -= 500;
                    svoSupport += 50;
                    addPatriotism(50);
                } else {
                    addMessageToChat("Недостаточно денег!", 'system');
                }
            } else if (decision.includes("Заключить союз с Китаем")) {
                addPatriotism(50);
                loyalty += 5;
                if (loyalty > 100) loyalty = 100;
            } else if (decision.includes("Подать заявку в НАТО")) {
                addPatriotism(-100);
                addAgents(50);
                extremism += 10;
            } else if (decision.includes("Ужесточить цензуру")) {
                addPatriotism(-20);
                addAgents(30);
                extremism += 5;
            } else if (decision.includes("Разогнать оппозицию")) {
                addPatriotism(-50);
                addAgents(100);
                extremism += 20;
            } else if (decision.includes("Поддержать ЛНР/ДНР")) {
                addPatriotism(30);
                svoSupport += 20;
            } else if (decision.includes("Запретить ЛГБТ")) {
                addPatriotism(15);
                extremism += 10;
            } else if (decision.includes("Арестовать иноагентов")) {
                addPatriotism(10);
                addAgents(-20);
                extremism += 5;
            } else if (decision.includes("Повысить зарплату военным")) {
                if (money >= 200) {
                    money -= 200;
                    svoSupport += 30;
                } else {
                    addMessageToChat("Недостаточно денег!", 'system');
                }
            } else if (decision.includes("Открыть военную базу за рубежом")) {
                if (money >= 1000) {
                    money -= 1000;
                    svoSupport += 100;
                    addPatriotism(20);
                } else {
                    addMessageToChat("Недостаточно денег!", 'system');
                }
            } else if (decision.includes("Увеличить призывников")) {
                extremism += 15;
                svoSupport += 25;
                addPatriotism(-10);
            }

            updateStats();
            switchToMain();
        }

        // Функция добавления патриотизма
        function addPatriotism(amount) {
            patriotism += amount;
            updateStats();
        }

        // Функция добавления иноагентов
        function addAgents(amount) {
            agents += amount;
            if (agents < 0) agents = 0;
            updateStats();
        }

        // Функция добавления в чат
        function addMessageToChat(message, type = 'system') {
            const p = document.createElement('p');
            p.textContent = message;
            p.className = 'chat-message';
            
            if (type === 'player') {
                p.classList.add('player-message');
            } else if (type === 'enemy') {
                p.classList.add('enemy-message');
            }
            
            battleChat.appendChild(p);
            battleChat.scrollTop = battleChat.scrollHeight;
        }

        // Функция добавления в дисплей
        function appendToDisplay(value) {
            // Применение ограничений от иноагентов
            if (agents >= 100 && Math.random() < 0.1 * (agents / 1000)) {
                value = ['0','1','2','3','4','5','6','7','8','9','+','-','*','/'][Math.floor(Math.random() * 14)];
            }
            display.value += value;
            displayValue = display.value;
        }

        // Функция очистки дисплея
        function clearDisplay() {
            display.value = '';
            displayValue = '';
        }

        // Функция вычисления
        function calculate() {
            try {
                let expression = display.value;
                // Применение ограничений от иноагентов
                if (agents >= 100 && Math.random() < 0.1 * (agents / 1000)) {
                    const chars = expression.split('');
                    if (chars.length > 0) {
                        const randomIndex = Math.floor(Math.random() * chars.length);
                        chars[randomIndex] = ['0','1','2','3','4','5','6','7','8','9','+','-','*','/'][Math.floor(Math.random() * 14)];
                        expression = chars.join('');
                    }
                }
                let result = eval(expression);
                display.value = result;
                displayValue = result.toString();
                
                // Проверка триггеров ФСБ
                if (result == 20 || result == 31 || result == 666) {
                    showFSBMessage("участие в экстремистском сообществе");
                } else if (result == 1488) {
                    showFSBMessage("реабилитация нацизма");
                } else if (result == 0) {
                    showFSBMessage("дискредитация ВС РФ");
                }
            } catch (error) {
                display.value = 'Error';
                displayValue = 'Error';
            }
        }

        // Функция показа сообщения ФСБ
        function showFSBMessage(reason) {
            fsbReason.textContent = "Причина: " + reason;
            fsbMessage.style.display = 'flex';
            setTimeout(function() {
                fsbMessage.style.display = 'none';
            }, 5000);
        }

        // Функция начала битвы
        function startBattle(enemyType) {
            battleInProgress = true;
            currentEnemy = enemyType;
            playerMorality = 100;
            enemyReputation = getEnemyMaxHealth(enemyType);
            
            // Скрываем калькулятор и показываем экран битвы
            document.getElementById('calculator').style.display = 'none';
            battleScreen.style.display = 'block';
            battleChat.innerHTML = ''; // Очищаем чат
            
            // Останавливаем гимн и запускаем боевую музыку
            anthem.pause();
            battleMusic.currentTime = 0;
            battleMusic.play();
            
            // Добавляем приветственное сообщение
            addMessageToChat(`Началась словесная перепалка с ${getEnemyDisplayName(enemyType)}!`, 'system');
            addMessageToChat("Выбирайте: Атаковать или Лечиться.", 'system');
            
            // Начинаем AI врага
            setTimeout(enemyTurn, 2000);
        }

        // Функция получения максимального здоровья врага
        function getEnemyMaxHealth(enemyType) {
            switch(enemyType) {
                case 'solovev': return 100;
                case 'medvedev': return 150;
                case 'putin': return 200;
                case 'gays': return 80;
                case 'uncle_sam': return 120;
                case 'satan': return 250;
                default: return 100;
            }
        }

        // Функция получения отображаемого имени врага
        function getEnemyDisplayName(enemyType) {
            switch(enemyType) {
                case 'solovev': return "Владимиром Соловьёвым";
                case 'medvedev': return "Дмитрием Медведевым";
                case 'putin': return "Владимиром Путиным";
                case 'gays': return "парой активистов ЛГБТ";
                case 'uncle_sam': return "Дядей Сэмом";
                case 'satan': return "Самим Сатаной";
                default: return "неизвестным противником";
            }
        }

        // Функция атаки игрока
        attackButton.onclick = function() {
            if (!battleInProgress) return;
            
            let attackMessage = "";
            let damage = 0;
            
            if (currentEnemy === 'solovev' || currentEnemy === 'medvedev' || currentEnemy === 'putin') {
                // Атака против пропагандистов
                damage = 15 + Math.floor(Math.random() * 10);
                attackMessage = "Вы атаковали «Свободой слова»!";
            } else {
                // Атака против "врагов государства"
                damage = 20 + Math.floor(Math.random() * 15);
                attackMessage = "Вы атаковали символом «Z»!";
            }
            
            enemyReputation -= damage;
            if (enemyReputation < 0) enemyReputation = 0;
            
            addMessageToChat(attackMessage, 'player');
            addMessageToChat(`Нанесено ${damage} урона репутации противника!`, 'player');
            
            // Проверка победы
            if (enemyReputation <= 0) {
                endBattle(true);
                return;
            }
            
            // Ход врага
            setTimeout(enemyTurn, 1500);
        };

        // Функция лечения игрока
        healButton.onclick = function() {
            if (!battleInProgress) return;
            
            let healAmount = 0;
            let healMessage = "";
            
            if (currentEnemy === 'solovev' || currentEnemy === 'medvedev' || currentEnemy === 'putin') {
                // Лечение против пропагандистов
                healAmount = 20 + Math.floor(Math.random() * 10);
                healMessage = "Вы вылечились с помощью «Демократии»!";
            } else {
                // Лечение против "врагов государства"
                healAmount = 25 + Math.floor(Math.random() * 15);
                healMessage = "Вы вылечились с помощью «Подорожника»!";
            }
            
            playerMorality += healAmount;
            if (playerMorality > 100) playerMorality = 100;
            
            addMessageToChat(healMessage, 'player');
            addMessageToChat(`Восстановлено ${healAmount} морали!`, 'player');
            
            // Ход врага
            setTimeout(enemyTurn, 1500);
        };

        // Функция хода врага
        function enemyTurn() {
            if (!battleInProgress) return;
            
            let enemyMessage = "";
            let damage = 0;
            let healAmount = 0;
            
            // Определяем, будет ли враг атаковать или лечиться
            const willHeal = Math.random() < 0.3; // 30% шанс на лечение
            
            if (currentEnemy === 'solovev') {
                if (willHeal) {
                    healAmount = 10 + Math.floor(Math.random() * 10);
                    enemyMessage = "Соловьёв: «Спасибо моим зрителям за поддержку!» (восстановил репутацию)";
                    enemyReputation += healAmount;
                } else {
                    damage = 15 + Math.floor(Math.random() * 10);
                    enemyMessage = "Соловьёв: «МРАЗЬ!!!»";
                    playerMorality -= damage;
                }
            } else if (currentEnemy === 'medvedev') {
                if (willHeal) {
                    healAmount = 15 + Math.floor(Math.random() * 10);
                    enemyMessage = "Медведев: «Выпил чашечку кофе и всё встало на свои места.» (восстановил репутацию)";
                    enemyReputation += healAmount;
                } else {
                    damage = 18 + Math.floor(Math.random() * 12);
                    enemyMessage = "Медведев: «Конец света близок.»";
                    playerMorality -= damage;
                }
            } else if (currentEnemy === 'putin') {
                if (willHeal) {
                    healAmount = 20 + Math.floor(Math.random() * 10);
                    enemyMessage = "Путин: «Подписан указ о повышении пенсий.» (восстановил репутацию)";
                    enemyReputation += healAmount;
                } else {
                    damage = 22 + Math.floor(Math.random() * 15);
                    enemyMessage = "Путин: «Украина — это искусственное образование...»";
                    playerMorality -= damage;
                }
            } else if (currentEnemy === 'gays') {
                if (willHeal) {
                    healAmount = 15 + Math.floor(Math.random() * 10);
                    enemyMessage = "Активисты: 💋 (страстный поцелуй восстановил их силы!)";
                    enemyReputation += healAmount;
                } else {
                    damage = 12 + Math.floor(Math.random() * 8);
                    enemyMessage = "Активисты: «Любовь — это право, а не привилегия!»";
                    playerMorality -= damage;
                }
            } else if (currentEnemy === 'uncle_sam') {
                if (willHeal) {
                    healAmount = 20 + Math.floor(Math.random() * 10);
                    enemyMessage = "Дядя Сэм: *хрум-хрум* БигМак — вот что дает мне силы!";
                    enemyReputation += healAmount;
                } else {
                    damage = 18 + Math.floor(Math.random() * 12);
                    enemyMessage = "Дядя Сэм: «Свобода, равенство, братство!»";
                    playerMorality -= damage;
                }
            } else if (currentEnemy === 'satan') {
                if (willHeal) {
                    healAmount = 30 + Math.floor(Math.random() * 20);
                    enemyMessage = "Сатана: *шшшш...* Огненный напалм — лучшее лекарство!";
                    enemyReputation += healAmount;
                } else {
                    damage = 25 + Math.floor(Math.random() * 15);
                    enemyMessage = "Сатана: «СМЕРТЬ СМЕРТНЫМ!»";
                    playerMorality -= damage;
                }
            }
            
            addMessageToChat(enemyMessage, 'enemy');
            
            if (damage > 0) {
                addMessageToChat(`Нанесено ${damage} урона вашей морали!`, 'enemy');
                if (playerMorality <= 0) {
                    endBattle(false);
                    return;
                }
            }
            
            if (healAmount > 0) {
                addMessageToChat(`Восстановлено ${healAmount} репутации противника!`, 'enemy');
                if (enemyReputation > getEnemyMaxHealth(currentEnemy)) {
                    enemyReputation = getEnemyMaxHealth(currentEnemy);
                }
            }
        }

        // Функция окончания битвы
        function endBattle(playerWon) {
            battleInProgress = false;
            
            if (playerWon) {
                addMessageToChat(`Поздравляем! Вы победили ${getEnemyDisplayName(currentEnemy)} в словесной перепалке!`, 'system');
                
                // Обработка победы над разными типами врагов
                if (currentEnemy === 'solovev') {
                    addPatriotism(-5000); // Штраф!
                    addAgents(-50);
                    addMessageToChat("Вы потеряли 5000 патриотизма за победу над системой!", 'system');
                } else if (currentEnemy === 'medvedev') {
                    addPatriotism(-50000); // Штраф!
                    addAgents(-200);
                    addMessageToChat("Вы потеряли 50000 патриотизма за победу над системой!", 'system');
                } else if (currentEnemy === 'putin') {
                    addPatriotism(-500000); // Штраф!
                    addAgents(-500);
                    addMessageToChat("Вы потеряли 500000 патриотизма за победу над системой!", 'system');
                    // Показываем первую концовку
                    setTimeout(() => showEndScreen('liberation'), 3000);
                    return;
                } else if (currentEnemy === 'gays') {
                    addPatriotism(2000);
                    addMessageToChat("Вы получили 2000 патриотизма за защиту традиционных ценностей!", 'system');
                } else if (currentEnemy === 'uncle_sam') {
                    addPatriotism(20000);
                    addMessageToChat("Вы получили 20000 патриотизма за победу над западным империализмом!", 'system');
                } else if (currentEnemy === 'satan') {
                    addPatriotism(200000);
                    addMessageToChat("Вы получили 200000 патриотизма за победу над самим Сатаной!", 'system');
                    // Показываем вторую концовку
                    setTimeout(() => showEndScreen('absolute_putinism'), 3000);
                    return;
                }
            } else {
                addMessageToChat(`Вы проиграли словесную перепалку с ${getEnemyDisplayName(currentEnemy)}!`, 'system');
                addMessageToChat("Ваши показатели патриотизма снижены вдвое!", 'system');
                addPatriotism(-Math.abs(patriotism) * 0.5);
            }
            
            // Через 3 секунды возвращаемся к калькулятору
            setTimeout(function() {
                battleScreen.style.display = 'none';
                document.getElementById('calculator').style.display = 'block';
                battleChat.innerHTML = '';
                // Останавливаем боевую музыку и возобновляем гимн
                battleMusic.pause();
                anthem.currentTime = 0;
                anthem.play();
            }, 3000);
        }

        // Функция показа экрана концовки
        function showEndScreen(endType) {
            battleScreen.style.display = 'none';
            endScreen.style.display = 'flex';
            
            if (endType === 'liberation') {
                endTitle.textContent = "КОНЕЦ 1: ОСВОБОЖДЕНИЕ РОССИИ";
                endText.innerHTML = "Вы победили систему пропаганды. Наступила эпоха свободы, демократии и ответственной власти. Россия встала на путь обновления. Конец? Или новое начало...";
            } else if (endType === 'absolute_putinism') {
                endTitle.textContent = "КОНЕЦ 2: ВОСХОД АБСОЛЮТНОГО ПУТИНИЗМА";
                endText.innerHTML = "Вы уничтожили всех врагов — внутренних и внешних, реальных и воображаемых. Ваш патриотизм достиг абсолютной величины. Владимир Владимирович Путин возвышается над нацией, как новый Сталин — отец, вождь и судья. Эпоха сомнений окончена. Наступила Эра Великого Путина.";
            }
        }

        // Обработчик кнопки "Начать заново"
        endButton.onclick = function() {
            // Сбрасываем все переменные
            patriotism = 0;
            agents = 0;
            extremism = 0;
            loyalty = 50;
            svoSupport = 0;
            money = 0;
            dollars = 0;
            deposit = 0;
            credit = 0;
            
            // Обновляем статистику
            updateStats();
            
            // Скрываем экран концовки и показываем калькулятор
            endScreen.style.display = 'none';
            document.getElementById('calculator').style.display = 'block';
            
            // Возобновляем гимн
            anthem.currentTime = 0;
            anthem.play();
        };

        // Начинаем первое голосование через 15 секунд
        setTimeout(showVoteModal, 15000);

        // Инициализируем статистику
        updateStats();

        // Добавляем обработчик клика по body для запуска аудио
        document.body.addEventListener('click', function() {
            if (anthem.paused) {
                anthem.play();
            }
        }, { once: true });

        // Добавляем возможность закрыть сообщение ФСБ кликом
        fsbMessage.addEventListener('click', function() {
            fsbMessage.style.display = 'none';
        });
    </script>
</body>
      </html>
